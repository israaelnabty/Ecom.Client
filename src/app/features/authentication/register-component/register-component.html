<!-- Outer Container: Dark Gradient Background -->
<div
    class="flex items-center justify-center min-h-[calc(100vh-80px)] bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 px-4 py-12">

    <!-- Card: Dark, Glassy look -->
    <mat-card
        class="w-full max-w-lg !bg-gray-800/80 !backdrop-blur-md !text-white !rounded-2xl !border !border-gray-700 !shadow-2xl overflow-hidden relative">

        <!-- Decorative Glow Top -->
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-500"></div>

        <mat-card-header class="mb-6 mt-4 flex flex-col items-center justify-center text-center">
            <!-- Icon Badge -->
            <div
                class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center mb-3 shadow-inner">
                <mat-icon class="text-indigo-400 !w-7 !h-7 !text-[28px]">person_add</mat-icon>
            </div>

            <mat-card-title
                class="!text-3xl !font-bold tracking-tight bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
                Create Account
            </mat-card-title>
            <p class="text-gray-400 text-sm mt-2">Join us to start shopping</p>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-5">

                <!-- Display Name -->
                <mat-form-field appearance="outline" class="w-full custom-dark-field">
                    <mat-label class="!text-gray-400">Full Name</mat-label>
                    <input matInput formControlName="displayName" placeholder="John Doe" class="!text-white">
                    <mat-icon matSuffix class="!text-gray-500">person</mat-icon>
                    @if (registerForm.get('displayName')?.hasError('required')) {
                    <mat-error>Name is required</mat-error>
                    }
                </mat-form-field>

                <!-- Email -->
                <mat-form-field appearance="outline" class="w-full custom-dark-field">
                    <mat-label class="!text-gray-400">Email Address</mat-label>
                    <input matInput type="email" formControlName="email" placeholder="user@example.com"
                        class="!text-white">
                    <mat-icon matSuffix class="!text-gray-500">email</mat-icon>
                    @if (registerForm.get('email')?.hasError('required')) {
                    <mat-error>Email is required</mat-error>
                    }
                    @if (registerForm.get('email')?.hasError('email')) {
                    <mat-error>Please enter a valid email</mat-error>
                    }
                </mat-form-field>

                <!-- Phone -->
                <mat-form-field appearance="outline" class="w-full custom-dark-field">
                    <mat-label class="!text-gray-400">Phone Number</mat-label>
                    <input matInput type="tel" formControlName="phoneNumber" placeholder="+20 123 456 7890"
                        class="!text-white">
                    <mat-icon matSuffix class="!text-gray-500">phone</mat-icon>
                </mat-form-field>

                <!-- Password -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <mat-form-field appearance="outline" class="w-full custom-dark-field">
                        <mat-label class="!text-gray-400">Password</mat-label>
                        <input matInput [type]="hidePassword() ? 'password' : 'text'" formControlName="password"
                            class="!text-white">
                        <button mat-icon-button matSuffix type="button" (click)="togglePassword($event)"
                            class="!text-gray-500 hover:!text-blue-400 transition-colors">
                            <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>
                        @if (registerForm.get('password')?.hasError('required')) {
                        <mat-error>Required</mat-error>
                        }
                        @if (registerForm.get('password')?.hasError('minlength')) {
                        <mat-error>Min 6 chars</mat-error>
                        }
                    </mat-form-field>

                    <!-- Confirm Password -->
                    <mat-form-field appearance="outline" class="w-full custom-dark-field">
                        <mat-label class="!text-gray-400">Confirm</mat-label>
                        <input matInput [type]="hideConfirmPassword() ? 'password' : 'text'"
                            formControlName="confirmPassword" class="!text-white">
                        <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPassword($event)"
                            class="!text-gray-500 hover:!text-blue-400 transition-colors">
                            <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>

                        <!-- Mismatch Error -->
                        @if (registerForm.hasError('mismatch') && (registerForm.get('confirmPassword')?.touched ||
                        registerForm.get('password')?.touched)) {
                        <mat-error>No match</mat-error>
                        }
                        @if (registerForm.get('confirmPassword')?.hasError('required')) {
                        <mat-error>Required</mat-error>
                        }
                    </mat-form-field>
                </div>

                <!-- Profile Image Upload (Styled for Dark Mode) -->
                <div
                    class="flex flex-col gap-2 p-4 rounded-xl border border-dashed border-gray-600 bg-gray-800/50 hover:bg-gray-700/50 transition-colors">
                    <label class="text-sm font-medium text-gray-400 mb-1">Profile Picture (Optional)</label>
                    <div class="flex items-center gap-4">
                        <button type="button" mat-stroked-button (click)="fileInput.click()"
                            class="!border-gray-500 !text-gray-300">
                            <mat-icon class="mr-2">cloud_upload</mat-icon> Choose File
                        </button>
                        <span class="text-sm text-gray-400 italic truncate max-w-[200px]">
                            {{ selectedFileName() || 'No file chosen' }}
                        </span>
                        <input #fileInput type="file" (change)="onFileSelected($event)" class="hidden" accept="image/*">
                    </div>
                </div>

                <!-- Sign Up Button -->
                <button mat-flat-button color="primary" type="submit" [disabled]="registerForm.invalid || isLoading()"
                    class="w-full !h-12 !text-lg !rounded-xl !bg-gradient-to-r !from-blue-600 !to-indigo-600 hover:!from-blue-500 hover:!to-indigo-500 !text-white !shadow-lg hover:!shadow-blue-500/25 hover:scale-[1.02] active:scale-95 transition-all duration-300 !flex !items-center !justify-center group mt-2 disabled:!bg-none disabled:!bg-gray-700 
               disabled:!text-gray-500 disabled:!shadow-none 
               disabled:!cursor-not-allowed disabled:!scale-100">

                    @if (isLoading()) {
                    <div class="flex items-center gap-2">
                        <mat-spinner diameter="24" class="custom-spinner"></mat-spinner>
                        <span>Creating Account...</span>
                    </div>
                    } @else {
                    <span class="flex items-center gap-2 font-semibold tracking-wide">
                        Sign Up <mat-icon
                            class="!w-5 !h-5 !text-lg group-hover:translate-x-1 transition-transform">rocket_launch</mat-icon>
                    </span>
                    }
                </button>

                <!-- Login Link -->
                <div class="text-center mt-2">
                    <p class="text-gray-400 text-sm">
                        Already have an account?
                        <a routerLink="/account/login"
                            class="text-blue-400 hover:text-blue-300 hover:underline font-medium transition-colors cursor-pointer">
                            Sign in
                        </a>
                    </p>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>