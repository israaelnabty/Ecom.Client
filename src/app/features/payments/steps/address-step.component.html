<div class="max-w-4xl mx-auto p-4 md:p-8">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Select Delivery Address</h1>

    <button mat-flat-button color="primary" (click)="openDialog()">
      <mat-icon>add</mat-icon> Add Address
    </button>
  </div>

  <!-- No addresses state -->
  @if (addresses().length === 0) {
    <div class="text-center py-12 bg-gray-100 border border-dashed rounded-lg">
      <mat-icon class="text-gray-400 text-6xl !w-16 !h-16">location_off</mat-icon>
      <p class="mt-2 text-gray-600">No addresses added yet.</p>
    </div>
  }

  <!-- Address Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    @for (addr of addresses(); track addr.id) {

      <mat-card 
        class="p-4 relative cursor-pointer transition border"
        [class.ring-2]="selectedAddressId() === addr.id"
        [class.ring-blue-500]="selectedAddressId() === addr.id"
        (click)="chooseAddress(addr)"
      >

        <div class="flex justify-between">
          <div>
            <h3 class="font-bold text-gray-800 flex items-center gap-2">
              <mat-icon class="text-gray-500 text-sm">home</mat-icon>
              {{ addr.city }}, {{ addr.country }}
            </h3>
            <p class="text-gray-600">{{ addr.street }}</p>
            <p class="text-gray-500 text-sm" *ngIf="addr.postalCode">{{ addr.postalCode }}</p>
          </div>

          <div class="flex gap-1">
            <button mat-icon-button color="primary" (click)="openDialog(addr); $event.stopPropagation()">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteAddress(addr.id); $event.stopPropagation()">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
        </div>

        <div class="mt-4">
          @if (selectedAddressId() !== addr.id) {
            <button mat-stroked-button color="primary" (click)="chooseAddress(addr); $event.stopPropagation()">
              Use this Address
            </button>
          } @else {
            <button mat-flat-button color="primary" disabled>
              Selected
            </button>
          }
        </div>

      </mat-card>

    }
  </div>

  <!-- Continue -->
  <div class="flex justify-end mt-10">
    <button
      mat-flat-button
      color="primary"
      class="px-10 py-2"
      [disabled]="!selectedAddressId()"
      (click)="continue()"
    >
      Continue
    </button>
  </div>

</div>
