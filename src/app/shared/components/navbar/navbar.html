<nav class="sticky top-0 z-50 bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 backdrop-blur-md shadow-lg border-b border-gray-700">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16 md:h-20">
      
      <!-- Logo -->
      <a routerLink="/" class="flex items-center gap-2.5 no-underline group">
        <div class="relative">
          <div class="w-14 h-14 rounded-full bg-gradient-to-br flex items-center justify-center shadow-lg group-hover:shadow-blue-500/50 transition-all duration-300 group-hover:scale-110 group-hover:rotate-3">
            <img src="ecom-icon.png" alt="E-Com Store Logo" class="!w-14 !h-14 !text-2xl group-hover:scale-110 transition-transform">
          </div>
          <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-indigo-400 rounded-full animate-pulse"></div>
        </div>
        <span class="text-xl md:text-2xl font-bold tracking-tight bg-gradient-to-r from-blue-400 to-indigo-400 bg-clip-text text-transparent group-hover:from-blue-300 group-hover:to-indigo-300 transition-all">E-Com Store</span>
      </a>

      <!-- Desktop Navigation (Middle) -->
      <div class="hidden md:flex items-center gap-1 ml-8">
        <a routerLink="/shopping" routerLinkActive="!bg-gradient-to-r !from-blue-600 !to-indigo-600 !text-white !shadow-lg"
            class="px-5 py-2.5 rounded-xl hover:bg-gray-700/50 transition-all duration-300 text-gray-300 hover:text-white font-medium flex items-center gap-2 group">
          <mat-icon class="!text-xl group-hover:scale-110 transition-transform">storefront</mat-icon>
          <span>Shop</span>
        </a>
      </div>

      <!-- Spacer -->
      <span class="flex-1"></span>

      <!-- Right Side Icons -->
      <div class="flex items-center gap-1 md:gap-2">
        <!-- Authentication State Switch -->
        @if (isAuthenticated()) {
          <!-- Wishlist Icon -->
          <button mat-icon-button routerLink="/wishlist" routerLinkActive="!bg-gray-700" class="!text-gray-400 hover:!text-red-400 hover:!bg-gray-700 transition-all duration-300 !rounded-xl group relative">
            <mat-icon
              routerLinkActive="!text-red-400"
              [matBadge]="totalWishlistItems()"
              matBadgeColor="warn"
              [matBadgeHidden]="totalWishlistItems() === 0"
              class="group-hover:scale-110 transition-transform">
              favorite_border
            </mat-icon>
            <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 hidden group-hover:block bg-gray-700 text-white text-xs px-3 py-1.5 rounded-lg whitespace-nowrap shadow-lg">
              Wishlist
              <span class="absolute top-full left-1/2 -translate-x-1/2 -mt-px w-2 h-2 bg-gray-700 rotate-45"></span>
            </span>
          </button>

          <!-- Cart Icon -->
          <button mat-icon-button routerLink="/cart" routerLinkActive="!bg-gray-700" class="!text-gray-400 hover:!text-blue-400 hover:!bg-gray-700 transition-all duration-300 !rounded-xl group relative">
            <mat-icon 
              routerLinkActive="!text-blue-400"
              [matBadge]="totalCartItems()" 
              matBadgeColor="warn"
              [matBadgeHidden]="totalCartItems() === 0"
              class="group-hover:scale-110 transition-transform">
              shopping_cart
            </mat-icon>
            <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 hidden group-hover:block bg-gray-700 text-white text-xs px-3 py-1.5 rounded-lg whitespace-nowrap shadow-lg">
              Cart
              <span class="absolute top-full left-1/2 -translate-x-1/2 -mt-px w-2 h-2 bg-gray-700 rotate-45"></span>
            </span>
          </button>

          <!-- LOGGED IN: User Dropdown -->
          <button mat-button [matMenuTriggerFor]="userMenu" class="!flex items-center gap-2.5 !px-3 !py-2.5 !min-w-0 !rounded-xl hover:!bg-gray-700 transition-all duration-300 !h-auto group">
            <!-- Avatar or Initials -->
            @if (currentUser()?.profileImageUrl) {
              <img class="w-9 h-9 rounded-full border-2 border-gray-600 object-cover shadow-lg flex-shrink-0 group-hover:border-blue-500 transition-all group-hover:scale-110"
                  [src]="currentUser()?.profileImageUrl" (error)="handleImageError($event)" alt="Avatar">
            } @else {
              <div class="w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center font-bold text-sm shadow-lg flex-shrink-0 group-hover:scale-110 transition-transform">
                {{ getInitials(currentUser()?.displayName) }}
              </div>
            }
            <span class="hidden sm:block truncate max-w-[100px] font-medium text-gray-300 group-hover:text-white transition-colors">
              {{ currentUser()?.displayName }}
            </span>
            <mat-icon class="!text-gray-400 group-hover:!text-white transition-colors">arrow_drop_down</mat-icon>
          </button>

          <!-- Menu Content -->
          <mat-menu #userMenu="matMenu" class="!mt-2">
            <div class="px-4 py-4 border-b border-gray-200 mb-1 bg-gradient-to-r from-gray-50 to-gray-100">
              <div class="flex items-center gap-3 mb-2">
                <!-- Avatar or Initials in Menu -->
                @if (currentUser()?.profileImageUrl) {
                  <img class="w-12 h-12 rounded-full border-2 border-gray-300 object-cover shadow-md flex-shrink-0"
                      [src]="currentUser()?.profileImageUrl" (error)="handleImageError($event)" alt="Avatar">
                } @else {
                  <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center font-bold text-base shadow-md flex-shrink-0">
                    {{ getInitials(currentUser()?.displayName) }}
                  </div>
                }
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-semibold text-gray-800 truncate">{{ currentUser()?.displayName }}</p>
                  <p class="text-xs text-gray-500 truncate">{{ currentUser()?.email }}</p>
                </div>
              </div>
            </div>

            <button mat-menu-item routerLink="/account/profile" class="!py-3 group">
              <mat-icon class="!text-gray-600 group-hover:!text-blue-600 transition-colors">person</mat-icon>
              <span class="ml-3 group-hover:translate-x-1 transition-transform inline-block">My Profile</span>
            </button>
            <button mat-menu-item routerLink="/orders" class="!py-3">
              <mat-icon class="!text-gray-600">shopping_bag</mat-icon>
              <span class="ml-3">My Orders</span>
            </button>
            <button mat-menu-item routerLink="/account/addresses" class="!py-3 group">
              <mat-icon class="!text-gray-600 group-hover:!text-blue-600 transition-colors">location_on</mat-icon>
              <span class="ml-3 group-hover:translate-x-1 transition-transform inline-block">My Addresses</span>
            </button>

            @if (isAdmin()) {
              <mat-divider class="!my-2"></mat-divider>
              <button mat-menu-item routerLink="/admin/dashboard" class="!text-purple-600 !py-3 !bg-purple-50 hover:!bg-purple-100 transition-colors group">
                <mat-icon color="primary" class="group-hover:scale-110 transition-transform">dashboard</mat-icon>
                <span class="ml-3 font-medium group-hover:translate-x-1 transition-transform inline-block">Admin Dashboard</span>
              </button>
            }

            <mat-divider class="!my-2"></mat-divider>

            <!-- LOGOUT BUTTON -->
            <button mat-menu-item (click)="logout()" class="!text-red-600 !py-3 hover:!bg-red-50 transition-colors group">
              <mat-icon color="warn" class="group-hover:scale-110 transition-transform">logout</mat-icon>
              <span class="ml-3 font-medium group-hover:translate-x-1 transition-transform inline-block">Sign Out</span>
            </button>
          </mat-menu>
        } @else {
          <!-- LOGIN BUTTON -->
          <a
            mat-stroked-button
            routerLink="/account/login"
            class="!border-2 !border-gray-600 !text-gray-300 !rounded-xl !px-5 !py-2.5 hover:!border-gray-400 hover:!bg-gray-700 hover:!text-white transition-all duration-300 !font-medium group flex items-center gap-2"
          >
            <mat-icon class="!text-xl group-hover:scale-110 transition-transform">login</mat-icon>
            <span>Sign In</span>
          </a>

          <!-- REGISTER BUTTON -->
          <a
            mat-flat-button
            routerLink="/account/register"
            class="!rounded-xl !px-5 !py-2.5 !bg-gradient-to-r !from-blue-600 !to-indigo-600 !text-white !shadow-lg hover:!shadow-xl hover:!from-blue-700 hover:!to-indigo-700 hover:scale-105 transition-all duration-300 !font-medium group flex items-center gap-2"
          >
            <mat-icon class="!text-xl group-hover:rotate-12 transition-transform">app_registration</mat-icon>
            <span>Register</span>
          </a>
        }
      </div>
    </div>
  </div>
</nav>