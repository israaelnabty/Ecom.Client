<mat-toolbar color="primary" class="!bg-white !text-gray-800 shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="container mx-auto flex items-center justify-between">

        <!-- Logo -->
        <a routerLink="/" class="flex items-center gap-2 no-underline text-gray-800">
            <mat-icon class="text-blue-600 !w-8 !h-8 !text-3xl">shopping_bag</mat-icon>
            <span class="text-xl font-bold tracking-tight">E-Com Store</span>
        </a>

        <!-- Desktop Navigation (Middle) -->
        <div class="hidden md:flex items-center gap-6 ml-8">
            <a routerLink="/shop" routerLinkActive="text-blue-600 font-semibold"
                class="hover:text-blue-600 transition-colors">Shop</a>
            <a routerLink="/categories" routerLinkActive="text-blue-600 font-semibold"
                class="hover:text-blue-600 transition-colors">Categories</a>
            <a routerLink="/deals" routerLinkActive="text-blue-600 font-semibold"
                class="hover:text-blue-600 transition-colors">Deals</a>
        </div>

        <!-- Spacer -->
        <span class="flex-1"></span>

        <!-- Right Side Icons -->
        <div class="flex items-center gap-2">

            <!-- Search (Optional placeholder) -->
            <button mat-icon-button class="text-gray-600">
                <mat-icon>search</mat-icon>
            </button>

            <!-- Cart -->
            <button mat-icon-button class="text-gray-600" routerLink="/cart">
                <mat-icon matBadge="0" matBadgeColor="warn" matBadgeSize="small">shopping_cart</mat-icon>
            </button>

            <!-- Authentication State Switch -->
            @if (authService.currentUser()) {
            <!-- LOGGED IN: User Dropdown -->
            <button mat-button [matMenuTriggerFor]="userMenu" class="!flex items-center gap-2 !px-2 !min-w-0">
                <!-- Avatar or Initials -->
                @if (authService.currentUser()?.profileImageUrl) {
                <img class="w-8 h-8 rounded-full border border-gray-200 object-cover"
                    [src]="authService.currentUser()?.profileImageUrl" (error)="handleImageError($event)" alt="Avatar">
                } @else {
                <div
                    class="w-8 h-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-xs">
                    {{ getInitials(authService.currentUser()?.displayName) }}
                </div>
                }
                <span class="hidden sm:block truncate max-w-[100px]">
                    {{ authService.currentUser()?.displayName }}
                </span>
                <mat-icon>arrow_drop_down</mat-icon>
            </button>

            <!-- Menu Content -->
            <mat-menu #userMenu="matMenu" class="w-56">
                <div class="px-4 py-3 border-b border-gray-100 mb-2">
                    <p class="text-sm font-semibold text-gray-800 truncate">{{ authService.currentUser()?.displayName }}
                    </p>
                    <p class="text-xs text-gray-500 truncate">{{ authService.currentUser()?.email }}</p>
                </div>

                <button mat-menu-item routerLink="/account/profile">
                    <mat-icon>person</mat-icon>
                    <span>My Profile</span>
                </button>
                <button mat-menu-item routerLink="/account/orders">
                    <mat-icon>shopping_bag</mat-icon>
                    <span>My Orders</span>
                </button>
                <button mat-menu-item routerLink="/account/addresses">
                    <mat-icon>location_on</mat-icon>
                    <span>My Addresses</span>
                </button>

                @if (isAdmin()) {
                <mat-divider></mat-divider>
                <button mat-menu-item routerLink="/admin/dashboard" class="!text-purple-600">
                    <mat-icon color="primary">dashboard</mat-icon>
                    <span>Admin Dashboard</span>
                </button>
                }

                <mat-divider></mat-divider>

                <!-- LOGOUT BUTTON -->
                <button mat-menu-item (click)="logout()" class="!text-red-600">
                    <mat-icon color="warn">logout</mat-icon>
                    <span>Sign Out</span>
                </button>
            </mat-menu>

            } @else {
            <!-- LOGGED OUT: Login Button -->
            <a mat-flat-button color="primary" routerLink="/account/login" class="ml-2">
                Sign In
            </a>
            }

        </div>
    </div>
</mat-toolbar>